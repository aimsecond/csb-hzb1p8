(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{15:function(e,t,c){},17:function(e,t,c){"use strict";c.r(t);var r=c(1),s=c(5),n=(c(14),c(3)),i=(c(15),c(2)),o=c(0),j=new Date("04/01/2023 00:00:00"),l=function(){return new i.a({freq:i.a.MONTHLY,bymonthday:1,wkst:i.a.SU})},d=function(e){return new i.a({freq:i.a.MONTHLY,bymonthday:1,wkst:i.a.SU,dtstart:a(e)})};function a(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()))}function b(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}function h(){var e=Object(r.useState)(new Date),t=Object(n.a)(e,2),c=t[0],s=t[1],i=Object(r.useState)(l().after(j,!1)),h=Object(n.a)(i,2),O=h[0],u=h[1],x=Object(r.useState)(b(d(j).after(a(j)))),m=Object(n.a)(x,2),p=m[0],f=m[1];return Object(r.useEffect)((function(){var e=setInterval((function(){return s(new Date)}),1e3);return u(l().after(j,!1)),f(b(d(j).after(a(j)))),function(){clearInterval(e)}}),[c]),Object(o.jsx)("div",{className:"App",children:Object(o.jsxs)("div",{className:"container",class:"mt-5 ms-5",children:[Object(o.jsx)("h2",{children:"RRule demo"}),Object(o.jsxs)("p",{children:["When ",Object(o.jsx)("code",{children:"event_start"})," is set, sometimes the"," ",Object(o.jsx)("code",{children:"next_occurrence"})," computed by Recurrence component is not correct.",Object(o.jsx)("br",{}),"This is because we use local time for all the computation, while the underlying package",Object(o.jsx)("a",{href:"https://github.com/jakubroztocil/rrule",children:" rrule "})," strongly advise that users should"," ",Object(o.jsx)("a",{href:"https://github.com/jakubroztocil/rrule#important-use-utc-dates",children:"always use UTC time"}),".",Object(o.jsx)("br",{}),"Here is another discussion about"," ",Object(o.jsx)("a",{href:"https://github.com/jakubroztocil/rrule/issues/336",children:"rrule timezone support"}),", which is a common confusion. And basically the most upvoted reply said",Object(o.jsx)("br",{}),"converting to and from UTC is the best practice.",Object(o.jsx)("br",{})]}),Object(o.jsxs)("p",{children:["The fix is simple, when ",Object(o.jsx)("code",{children:"event_start"})," is set:",Object(o.jsx)("br",{}),"1. always convert ",Object(o.jsx)("code",{children:"event_start"})," to UTC before calculation",Object(o.jsx)("br",{}),"2. always convert calculated ",Object(o.jsx)("code",{children:"next_occurrence"})," from UTC to local timezone for display",Object(o.jsx)("br",{}),"3. Add ",Object(o.jsx)("code",{children:"DTSTART"})," flag in rrule (important!)"]}),Object(o.jsx)("p",{children:"Now we can take a look at how it could go wrong and how does our fix can resolve it."}),Object(o.jsxs)("p",{children:["In this demo, ",Object(o.jsx)("code",{children:"event_start"})," is set as"," ",Object(o.jsx)("code",{children:'new Date("04/01/2023 00:00:00")'}),":"]}),Object(o.jsx)("div",{class:"col-md-9",children:Object(o.jsxs)("table",{class:"table table-striped table-bordered",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{}),Object(o.jsx)("th",{children:"local time zone"}),Object(o.jsx)("th",{children:"UTC"})]})}),Object(o.jsx)("tbody",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:Object(o.jsx)("code",{children:"event_start"})}),Object(o.jsx)("td",{children:j.toString()}),Object(o.jsx)("td",{children:j.toISOString()})]})})]})}),Object(o.jsxs)("p",{children:["And your current system time is ",c.toString(),":"]}),Object(o.jsx)("div",{class:"col-md-9",children:Object(o.jsxs)("table",{class:"table table-striped table-bordered",children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{colspan:"2"}),Object(o.jsxs)("th",{children:["Before fix:",Object(o.jsx)("br",{}),"use local timezone ",Object(o.jsx)("code",{children:"event_start"})," for computation,",Object(o.jsx)("br",{}),"Do NOT set ",Object(o.jsx)("code",{children:"DTSTART"})," flag in rrule"]}),Object(o.jsxs)("th",{children:["After fix:",Object(o.jsx)("br",{}),"use UTC ",Object(o.jsx)("code",{children:"event_start"})," for computation,",Object(o.jsx)("br",{}),"Set ",Object(o.jsx)("code",{children:"DTSTART"})," flag in rrule"]})]})}),Object(o.jsxs)("tbody",{children:[Object(o.jsxs)("tr",{children:[Object(o.jsxs)("td",{colspan:"2",children:["RRULE String:",Object(o.jsx)("br",{}),l().toText()]}),Object(o.jsx)("td",{id:"rule-1",children:l().toString()}),Object(o.jsx)("td",{id:"rule-2",children:d(j).toString()})]}),Object(o.jsxs)("tr",{children:[Object(o.jsxs)("td",{rowspan:"2",children:[Object(o.jsx)("code",{children:"next_occurrence"})," computed"]}),Object(o.jsxs)("td",{children:["local time zone:"," ",Intl.DateTimeFormat().resolvedOptions().timeZone]}),Object(o.jsx)("td",{style:{color:"red"},id:"rule-1-local",children:O.toString()}),Object(o.jsx)("td",{style:{color:"green"},id:"rule-2-local",children:p.toString()})]}),Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:Object(o.jsx)("span",{children:"UTC"})}),Object(o.jsx)("td",{id:"rule-1-utc",children:O.toISOString()}),Object(o.jsx)("td",{id:"rule-2-utc",children:p.toISOString()})]})]})]})}),Object(o.jsxs)("p",{children:["If user set ",Object(o.jsx)("code",{children:"event_start"})," as Apr.1 and rrule is every month on the 1st, then ",Object(o.jsx)("code",{children:"next_occurence"})," is expected to be"," ",Object(o.jsx)("span",{style:{color:"green"},children:"May.1 (the green date)"}),Object(o.jsx)("br",{}),"However, if we stick to the original logic, you may see"," ",Object(o.jsx)("span",{style:{color:"red"},children:"Apr.1 or Apr.30 (the red date)"})," ","as result. More specifically, ",Object(o.jsx)("br",{}),"if user is in America/Los_Angeles(PST) time zone, the user will see Apr.30 when his/her local time falls bewteen",Object(o.jsx)("br",{}),"16:00-22:59 PM; and Apr.1 for the rest of the time.",Object(o.jsx)("br",{}),"Please feel free to play around with the ",Object(o.jsx)("code",{children:"event_start"}),", rrule and local system time, to see how computed"," ",Object(o.jsx)("code",{children:"next_occurrence"})," will change!"]})]})})}var O=document.getElementById("root");Object(s.createRoot)(O).render(Object(o.jsx)(r.StrictMode,{children:Object(o.jsx)(h,{})}))}},[[17,1,2]]]);
//# sourceMappingURL=main.aee3945a.chunk.js.map